\hypertarget{logger_8c}{\section{/home/jon/projects/evlogger/evlogger/src/logger.c \-File \-Reference}
\label{logger_8c}\index{/home/jon/projects/evlogger/evlogger/src/logger.\-c@{/home/jon/projects/evlogger/evlogger/src/logger.\-c}}
}


\-E\-V \-Datalogger \-Project.  


{\ttfamily \#include $<$string.\-h$>$}\*
{\ttfamily \#include \char`\"{}\-H\-A\-L\-\_\-\-Dogs102x6.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}accel.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}logger.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}adc.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}ff.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}uart.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}system.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}typedefs.\-h\char`\"{}}\*
{\ttfamily \#include \char`\"{}mmc.\-h\char`\"{}}\*
\subsection*{\-Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{group__logger_ga7dd46e9f5adb1f95d06cecebcd77131c}{rb\-\_\-getused\-\_\-m}(b)~((b-\/$>$tail==b-\/$>$head) ? 0\-:(b-\/$>$head -\/ b-\/$>$tail + b-\/$>$len) \% b-\/$>$len)
\begin{DoxyCompactList}\small\item\em \-Quick facility to get the used value of a ring buffer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__logger_ga35dd3a7fa4393edc7a82d7e00ea062f2}{rb\-\_\-getfree\-\_\-m}(b)~((b-\/$>$tail==b-\/$>$head) ? b-\/$>$len \-: (b-\/$>$tail -\/ b-\/$>$head + b-\/$>$len) \% b-\/$>$len)
\begin{DoxyCompactList}\small\item\em \-Quick facility to get the free value of a ring buffer. \end{DoxyCompactList}\item 
\#define \hyperlink{group__logger_ga44d4b9b7c0b6f5dd08e9416d092bdfb3}{rb\-\_\-reset\-\_\-m}(b)~do \{b-\/$>$tail = b-\/$>$head = 0\} while (0)
\begin{DoxyCompactList}\small\item\em \-Reset a ring buffer to its original empty state. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{\-Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{group__logger_ga7f0a1ef369c8017a21abc0f68371b64e}{logger\-\_\-init} (void)
\begin{DoxyCompactList}\small\item\em \-Set up the hardware for logging functionality, including the configuration of required peripherals such as the \-A\-D\-C and \-Accelerometer. \end{DoxyCompactList}\item 
void \hyperlink{group__logger_gaf8a40257f5965ff6dd711c8b3923e4d1}{update\-\_\-lcd} (\hyperlink{structRingBuffer}{\-Ring\-Buffer} $\ast$buf)
\begin{DoxyCompactList}\small\item\em \-Update the \-L\-C\-D with the current status of the logger service. \end{DoxyCompactList}\item 
void \hyperlink{group__logger_gae7aec9e9b6c4a25bda9ff4b5498aedee}{sd\-\_\-setup} (\hyperlink{structRingBuffer}{\-Ring\-Buffer} $\ast$\hyperlink{group__logger_gad897897d6e8cd86086d5ebaa9a21d0d4}{sdbuf})
\begin{DoxyCompactList}\small\item\em \-Set up the \-S\-D card for logging to it. \end{DoxyCompactList}\item 
\-F\-R\-E\-S\-U\-L\-T \hyperlink{group__logger_gad722dfdb4da7ee009462dde1a83f4358}{sd\-\_\-write} (\hyperlink{structRingBuffer}{\-Ring\-Buffer} $\ast$rb, char $\ast$\hyperlink{group__logger_ga8e106526932e3c95b903409ab35b0882}{writebuf}, \-F\-I\-L $\ast$\hyperlink{group__logger_ga4be63952e3c9cb0f46f9e592b3c78714}{fil}, \hyperlink{typedefs_8h_a1f1825b69244eb3ad2c7165ddc99c956}{uint16\-\_\-t} n)
\begin{DoxyCompactList}\small\item\em \-Write n bytes from a ring buffer to an \-S\-D card controlled by fatfs. \end{DoxyCompactList}\item 
\hyperlink{typedefs_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} \hyperlink{group__logger_gab8bdf9f19d8d4ebacc793b22afd90768}{ringbuf\-\_\-write} (\hyperlink{structRingBuffer}{\-Ring\-Buffer} $\ast$buf, char $\ast$data, \hyperlink{typedefs_8h_a1f1825b69244eb3ad2c7165ddc99c956}{uint16\-\_\-t} n)
\begin{DoxyCompactList}\small\item\em \-Write n bytes to a ring buffer. \end{DoxyCompactList}\item 
\hyperlink{typedefs_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} \hyperlink{group__logger_ga78ecc0240d02beed08b04f5c69dd3f2c}{ringbuf\-\_\-read} (\hyperlink{structRingBuffer}{\-Ring\-Buffer} $\ast$buf, char $\ast$read\-\_\-buffer, \hyperlink{typedefs_8h_a1f1825b69244eb3ad2c7165ddc99c956}{uint16\-\_\-t} n)
\begin{DoxyCompactList}\small\item\em \-Read n bytes from a ring buffer. \end{DoxyCompactList}\item 
void \hyperlink{group__logger_gadf69ccbc6389e013322d06a0516d9db5}{logger\-\_\-enable} (void)
\begin{DoxyCompactList}\small\item\em \-Enable \-T\-A1 to begin logging by setting mode control to \char`\"{}up\char`\"{} mode, counter counts to \-T\-Ax\-C\-C\-R0. \end{DoxyCompactList}\item 
void \hyperlink{group__logger_gaeb449c011f90affd5c104e98298704b5}{logger\-\_\-disable} (void)
\begin{DoxyCompactList}\small\item\em \-Disable \-T\-A1 to halt logging by setting mode control to \-S\-T\-O\-P. \end{DoxyCompactList}\item 
\hyperlink{group__logger_ga190ea6537ba0138967b2f60ce4913c8d}{interrupt} (\-T\-I\-M\-E\-R1\-\_\-\-A0\-\_\-\-V\-E\-C\-T\-O\-R)
\begin{DoxyCompactList}\small\item\em \-Interrupt for \-T\-A1, here we should log one block of data to the \-S\-D card. \end{DoxyCompactList}\item 
\hyperlink{group__logger_gaaef39e368becfc8ede2d7e992660ded8}{interrupt} (\-P\-O\-R\-T1\-\_\-\-V\-E\-C\-T\-O\-R)
\begin{DoxyCompactList}\small\item\em \-Interrupt vector for button \-S1. \end{DoxyCompactList}\item 
\hyperlink{group__logger_ga27007f0867b8c6ce1fb3b7943e2bc945}{interrupt} (\-P\-O\-R\-T2\-\_\-\-V\-E\-C\-T\-O\-R)
\begin{DoxyCompactList}\small\item\em \-Interrupt vector for button \-S2. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{\-Variables}
\begin{DoxyCompactItemize}
\item 
volatile \hyperlink{typedefs_8h_a06896e8c53f721507066c079052171f8}{uint32\-\_\-t} \hyperlink{group__logger_ga1b0c2354b01b207919e638c5db342824}{time}
\item 
volatile \hyperlink{typedefs_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} \hyperlink{group__logger_ga10ab8a8cd50badbe26d5d0e04b263f92}{logger\-\_\-running}
\item 
volatile \hyperlink{typedefs_8h_aba7bc1797add20fe3efdf37ced1182c5}{uint8\-\_\-t} \hyperlink{group__logger_ga0eb1ac42313417f7c16e8fca853fd12f}{file\-\_\-open}
\item 
char \hyperlink{group__logger_ga264c2cc44242eb9a8430539752d1b432}{s} \mbox{[}\hyperlink{uart_8h_aeec38153163908e428304567b3623e03}{\-U\-A\-R\-T\-\_\-\-B\-U\-F\-\_\-\-L\-E\-N}\mbox{]}
\item 
char \hyperlink{group__logger_ga0c58ec988b438001baccda2c77966547}{ringbuf} \mbox{[}\hyperlink{logger_8h_afacd61cc6eb6a06283bfc5a9824e0760}{\-S\-D\-\_\-\-R\-I\-N\-G\-B\-U\-F\-\_\-\-L\-E\-N}\mbox{]}
\item 
char \hyperlink{group__logger_ga8e106526932e3c95b903409ab35b0882}{writebuf} \mbox{[}512\mbox{]}
\item 
\hyperlink{structRingBuffer}{\-Ring\-Buffer} \hyperlink{group__logger_gad897897d6e8cd86086d5ebaa9a21d0d4}{sdbuf}
\item 
char \hyperlink{group__logger_ga90eeb31600a612b557aae5b7aa6f1c4d}{stringbuf} \mbox{[}50\mbox{]}
\item 
volatile \hyperlink{structSampleBuffer}{\-Sample\-Buffer} \hyperlink{group__logger_ga71df2a91147f5867de7713ac87c8f1aa}{sb}
\item 
\-F\-A\-T\-F\-S \hyperlink{group__logger_ga8f47e042c2aca024c6534fdf5c3d9426}{\-Fat\-Fs}
\item 
\-F\-I\-L \hyperlink{group__logger_ga4be63952e3c9cb0f46f9e592b3c78714}{fil}
\item 
\hyperlink{integer_8h_ad342ac907eb044443153a22f964bf0af}{\-D\-W\-O\-R\-D} \hyperlink{group__logger_ga94b465c64e7406994a32b0a3d6162264}{fsz}
\end{DoxyCompactItemize}


\subsection{\-Detailed \-Description}
\-E\-V \-Datalogger \-Project. \-Jon \-Sowman 2014 $<$\href{mailto:js39g13@soton.ac.uk}{\tt js39g13@soton.\-ac.\-uk}$>$ \-University of \-Southampton

\begin{DoxyAuthor}{\-Author}
\-Jon \-Sowman 
\end{DoxyAuthor}
