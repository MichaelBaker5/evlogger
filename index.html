<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>EV Logger: Electric Vehicle Datalogger</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EV Logger
   </div>
   <div id="projectbrief">A MSP430 based datalogger for an electric vehicle</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Electric Vehicle Datalogger </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>This project uses an MSP430 (specifically, the MSP430F5529) to log data from various channels to be used on an electric vehicle. This project is designed for use on the MSP-EXP430F5529LP experimentation board which is available from Texas Instruments.</p>
<h1><a class="anchor" id="spec"></a>
Specification</h1>
<p>There are six analogue channels broken out on the development board, plus a user potentiometer. Additionally, there is a CMA3000 3-axis accelerometer which is capable of running at up to 400Hz. The analogue channels (including the pot) are sampled and logged at 1kHz. The accelerometer is also logged at this frequency though analysis of the output will confirm that its value only changes at 400Hz.</p>
<h1><a class="anchor" id="software"></a>
Software Architecture</h1>
<p>The software documented here is written specifically for the project, but libraries and hardware abstraction layer utilities are used from various sources which are documentented in the code. Licenses for these parts of the code are respected and as such, copyright notices will be found in some source files where they were used as the basis for the code.</p>
<p>The main functionality for the datalogger is in the Logger module. The overall architecture overview is that we set up a timer to interrupt at the log frequency, which collects available data and puts it into a buffer ready to be transferred to the SD card. It then invalidates the data and triggers another conversion run such that on the next interrupt, the new data will be ready.</p>
<p>A software controlled <a class="el" href="structRingBuffer.html" title="A ring buffer which can be attached to given (preallocated) memory area. ">RingBuffer</a> is used to store data before it is transferred to the SD card, and a full ring buffer implementation can be found in the Logger module. This is generic and can be used in other projects. The size of this buffer is controlled by SD_RINGBUF_LEN, and should be as large as possible for best performance but should never be smaller than the sector size (usually 512 bytes for FAT16).</p>
<p>The peripherals are controlled by separate modules, see ADC, Accelerometer, UART particularly. Documentation for how these are configured can be found in the relevant source files; here it suffices to note that CPU time is minimised by use of DMA in the case of the ADC and an interrupt controlled finite state machine (FSM) in the case of the accelerometer. The UART is principally for debugging purposes and is not set up for speed (it currently busy-waits during transmits) and as such, should not be used in production runs of the firmware builds.</p>
<p>The onboard peripherals, perticularly the CPU core clock and system wall clock timer are controlled by the System module, relevant documentation is contained within.</p>
<h1><a class="anchor" id="build"></a>
Building the Firmware</h1>
<p>A Makefile is provided to build the firmware using the GNU mspgcc toolchain. Builds of this toolchain are available for Windows, OS X and Linux though on Windows you will need to set an IDE up as appropriate since the Makefile will not work (unless you use cygwin). To build the firmware using the Makefile please change to the source directory and run $ make. Flashing the device is done using mspdebug over the Spy-by-Wire interface, and can be enacted by running $ make flash. Cleaning the build directory (deleting all object files, dependency list files and binaries) can be done using $ make clean.</p>
<h1><a class="anchor" id="author"></a>
Authorship</h1>
<p>Jon Sowman, University of Southampton <a href="#" onclick="location.href='mai'+'lto:'+'j.s'+'ow'+'man'+'@s'+'oto'+'n.'+'ac.'+'uk'; return false;">j.sow<span style="display: none;">.nosp@m.</span>man@<span style="display: none;">.nosp@m.</span>soton<span style="display: none;">.nosp@m.</span>.ac.<span style="display: none;">.nosp@m.</span>uk</a>. Please get in touch with any questions or comments. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 5 2014 10:07:05 for EV Logger by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
