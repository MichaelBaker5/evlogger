<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>EV Logger: Logger</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EV Logger
   </div>
   <div id="projectbrief">A MSP430 based datalogger for an electric vehicle</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Logger</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structRingBuffer.html">RingBuffer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A ring buffer which can be attached to given (preallocated) memory area.  <a href="structRingBuffer.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSampleBuffer.html">SampleBuffer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A structure to contain one 'set' of samples from the vehicle.  <a href="structSampleBuffer.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga7dd46e9f5adb1f95d06cecebcd77131c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga7dd46e9f5adb1f95d06cecebcd77131c">rb_getused_m</a>(b)&#160;&#160;&#160;((b-&gt;tail==b-&gt;head) ? 0:(b-&gt;head - b-&gt;tail + b-&gt;len) % b-&gt;len)</td></tr>
<tr class="memdesc:ga7dd46e9f5adb1f95d06cecebcd77131c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Quick facility to get the used value of a ring buffer.  <a href="#ga7dd46e9f5adb1f95d06cecebcd77131c">More...</a><br/></td></tr>
<tr class="separator:ga7dd46e9f5adb1f95d06cecebcd77131c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga35dd3a7fa4393edc7a82d7e00ea062f2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga35dd3a7fa4393edc7a82d7e00ea062f2">rb_getfree_m</a>(b)&#160;&#160;&#160;((b-&gt;tail==b-&gt;head) ? b-&gt;len : (b-&gt;tail - b-&gt;head + b-&gt;len) % b-&gt;len)</td></tr>
<tr class="memdesc:ga35dd3a7fa4393edc7a82d7e00ea062f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Quick facility to get the free value of a ring buffer.  <a href="#ga35dd3a7fa4393edc7a82d7e00ea062f2">More...</a><br/></td></tr>
<tr class="separator:ga35dd3a7fa4393edc7a82d7e00ea062f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga44d4b9b7c0b6f5dd08e9416d092bdfb3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga44d4b9b7c0b6f5dd08e9416d092bdfb3">rb_reset_m</a>(b)&#160;&#160;&#160;do {b-&gt;tail = b-&gt;head = 0} while (0)</td></tr>
<tr class="memdesc:ga44d4b9b7c0b6f5dd08e9416d092bdfb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset a ring buffer to its original empty state.  <a href="#ga44d4b9b7c0b6f5dd08e9416d092bdfb3">More...</a><br/></td></tr>
<tr class="separator:ga44d4b9b7c0b6f5dd08e9416d092bdfb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac25d4bda2e5e60901d16ab23fab5f324"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gac25d4bda2e5e60901d16ab23fab5f324"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S1_PORT_OUT</b>&#160;&#160;&#160;P1OUT</td></tr>
<tr class="separator:gac25d4bda2e5e60901d16ab23fab5f324"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae1407069d60d2d9d6d43e0d872fe5066"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gae1407069d60d2d9d6d43e0d872fe5066"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S1_PORT_REN</b>&#160;&#160;&#160;P1REN</td></tr>
<tr class="separator:gae1407069d60d2d9d6d43e0d872fe5066"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac543535dbf43aab36ae46b652ac88cee"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gac543535dbf43aab36ae46b652ac88cee"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S1_PORT_IES</b>&#160;&#160;&#160;P1IES</td></tr>
<tr class="separator:gac543535dbf43aab36ae46b652ac88cee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5635524194bbc8911288f76fc0bb6b5b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga5635524194bbc8911288f76fc0bb6b5b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S1_PORT_IE</b>&#160;&#160;&#160;P1IE</td></tr>
<tr class="separator:ga5635524194bbc8911288f76fc0bb6b5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6dab5a96841f65e53b65fc30d25e987c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga6dab5a96841f65e53b65fc30d25e987c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S1_PORT_IFG</b>&#160;&#160;&#160;P1IFG</td></tr>
<tr class="separator:ga6dab5a96841f65e53b65fc30d25e987c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8766620bcdd3b4ffdae69e99def6458e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga8766620bcdd3b4ffdae69e99def6458e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S1_PIN</b>&#160;&#160;&#160;<a class="el" href="typedefs_8h.html#a483c9de27db573099572f5485ef841c9">_BV</a>(7)</td></tr>
<tr class="separator:ga8766620bcdd3b4ffdae69e99def6458e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7d2c3ed889c26e408d9760010877c743"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga7d2c3ed889c26e408d9760010877c743"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S2_PORT_OUT</b>&#160;&#160;&#160;P2OUT</td></tr>
<tr class="separator:ga7d2c3ed889c26e408d9760010877c743"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga145401ccd2b64b0b27f08e3b7f290d2a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga145401ccd2b64b0b27f08e3b7f290d2a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S2_PORT_REN</b>&#160;&#160;&#160;P2REN</td></tr>
<tr class="separator:ga145401ccd2b64b0b27f08e3b7f290d2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf4e0d6be993eceb8be68f0225e347b0c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaf4e0d6be993eceb8be68f0225e347b0c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S2_PORT_IES</b>&#160;&#160;&#160;P2IES</td></tr>
<tr class="separator:gaf4e0d6be993eceb8be68f0225e347b0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac36c10134cfc6b2f1b6c505246a14edc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gac36c10134cfc6b2f1b6c505246a14edc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S2_PORT_IE</b>&#160;&#160;&#160;P2IE</td></tr>
<tr class="separator:gac36c10134cfc6b2f1b6c505246a14edc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gada0fb6bcf89f5f8c0dd989f63a3a5abf"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gada0fb6bcf89f5f8c0dd989f63a3a5abf"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S2_PORT_IFG</b>&#160;&#160;&#160;P2IFG</td></tr>
<tr class="separator:gada0fb6bcf89f5f8c0dd989f63a3a5abf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad50338afe7b10c1aa188fde925109853"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad50338afe7b10c1aa188fde925109853"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>S2_PIN</b>&#160;&#160;&#160;<a class="el" href="typedefs_8h.html#a483c9de27db573099572f5485ef841c9">_BV</a>(2)</td></tr>
<tr class="separator:gad50338afe7b10c1aa188fde925109853"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafacd61cc6eb6a06283bfc5a9824e0760"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gafacd61cc6eb6a06283bfc5a9824e0760"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gafacd61cc6eb6a06283bfc5a9824e0760">SD_RINGBUF_LEN</a>&#160;&#160;&#160;2048</td></tr>
<tr class="memdesc:gafacd61cc6eb6a06283bfc5a9824e0760"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ring buffer length for the SD card, should be a multiple of 2 of the sector size (512 bytes) <br/></td></tr>
<tr class="separator:gafacd61cc6eb6a06283bfc5a9824e0760"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa92c48a4b6b3ea015e31a01e940c440b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gaa92c48a4b6b3ea015e31a01e940c440b">SD_RINGBUF_MASK</a>&#160;&#160;&#160;(<a class="el" href="group__logger.html#gafacd61cc6eb6a06283bfc5a9824e0760">SD_RINGBUF_LEN</a> - 1)</td></tr>
<tr class="memdesc:gaa92c48a4b6b3ea015e31a01e940c440b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The ring buffer mask value.  <a href="#gaa92c48a4b6b3ea015e31a01e940c440b">More...</a><br/></td></tr>
<tr class="separator:gaa92c48a4b6b3ea015e31a01e940c440b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga065dcfa648ca52ed6214008cb177de36"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga065dcfa648ca52ed6214008cb177de36">ADC_CHANNELS</a>&#160;&#160;&#160;7</td></tr>
<tr class="memdesc:ga065dcfa648ca52ed6214008cb177de36"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of ADC channels that we will sample from.  <a href="#ga065dcfa648ca52ed6214008cb177de36">More...</a><br/></td></tr>
<tr class="separator:ga065dcfa648ca52ed6214008cb177de36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga97ed3fe57790c99c8e351a42713c604d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga97ed3fe57790c99c8e351a42713c604d">ACCEL_CHANNELS</a>&#160;&#160;&#160;3</td></tr>
<tr class="memdesc:ga97ed3fe57790c99c8e351a42713c604d"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of accelerometer channels (typically 3) to be sampled from.  <a href="#ga97ed3fe57790c99c8e351a42713c604d">More...</a><br/></td></tr>
<tr class="separator:ga97ed3fe57790c99c8e351a42713c604d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gacc8f6cda4a415098348d3e3c222b2ac6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gacc8f6cda4a415098348d3e3c222b2ac6"></a>
typedef struct <a class="el" href="structRingBuffer.html">RingBuffer</a>&#160;</td><td class="memItemRight" valign="bottom"><b>RingBuffer</b></td></tr>
<tr class="separator:gacc8f6cda4a415098348d3e3c222b2ac6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga04b1abe6e9526dc4f1c490318dc72f78"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga04b1abe6e9526dc4f1c490318dc72f78"></a>
typedef struct <a class="el" href="structSampleBuffer.html">SampleBuffer</a>&#160;</td><td class="memItemRight" valign="bottom"><b>SampleBuffer</b></td></tr>
<tr class="separator:ga04b1abe6e9526dc4f1c490318dc72f78"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga7f0a1ef369c8017a21abc0f68371b64e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga7f0a1ef369c8017a21abc0f68371b64e">logger_init</a> (void)</td></tr>
<tr class="memdesc:ga7f0a1ef369c8017a21abc0f68371b64e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up the hardware for logging functionality, including the configuration of required peripherals such as the ADC and Accelerometer.  <a href="#ga7f0a1ef369c8017a21abc0f68371b64e">More...</a><br/></td></tr>
<tr class="separator:ga7f0a1ef369c8017a21abc0f68371b64e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf8a40257f5965ff6dd711c8b3923e4d1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gaf8a40257f5965ff6dd711c8b3923e4d1">update_lcd</a> (<a class="el" href="structRingBuffer.html">RingBuffer</a> *buf)</td></tr>
<tr class="memdesc:gaf8a40257f5965ff6dd711c8b3923e4d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the LCD with the current status of the logger, including buffer usage, data file size and SD card utilisation.  <a href="#gaf8a40257f5965ff6dd711c8b3923e4d1">More...</a><br/></td></tr>
<tr class="separator:gaf8a40257f5965ff6dd711c8b3923e4d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8b1e9f609a5fb4ca026b9f3a9e0ebc41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga8b1e9f609a5fb4ca026b9f3a9e0ebc41">start_logger</a> (<a class="el" href="structRingBuffer.html">RingBuffer</a> *<a class="el" href="group__logger.html#gad897897d6e8cd86086d5ebaa9a21d0d4">sdbuf</a>)</td></tr>
<tr class="memdesc:ga8b1e9f609a5fb4ca026b9f3a9e0ebc41"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up the SD card and the FATFS filesystem handler before commencing the logging service.  <a href="#ga8b1e9f609a5fb4ca026b9f3a9e0ebc41">More...</a><br/></td></tr>
<tr class="separator:ga8b1e9f609a5fb4ca026b9f3a9e0ebc41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad722dfdb4da7ee009462dde1a83f4358"><td class="memItemLeft" align="right" valign="top">FRESULT&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gad722dfdb4da7ee009462dde1a83f4358">sd_write</a> (<a class="el" href="structRingBuffer.html">RingBuffer</a> *rb, char *writebuf, FIL *<a class="el" href="group__logger.html#ga4be63952e3c9cb0f46f9e592b3c78714">fil</a>, uint16_t n)</td></tr>
<tr class="memdesc:gad722dfdb4da7ee009462dde1a83f4358"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write n bytes from a ring buffer to an SD card controlled by fatfs.  <a href="#gad722dfdb4da7ee009462dde1a83f4358">More...</a><br/></td></tr>
<tr class="separator:gad722dfdb4da7ee009462dde1a83f4358"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab8bdf9f19d8d4ebacc793b22afd90768"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gab8bdf9f19d8d4ebacc793b22afd90768">ringbuf_write</a> (<a class="el" href="structRingBuffer.html">RingBuffer</a> *buf, char *data, uint16_t n)</td></tr>
<tr class="memdesc:gab8bdf9f19d8d4ebacc793b22afd90768"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write n bytes to a <a class="el" href="structRingBuffer.html" title="A ring buffer which can be attached to given (preallocated) memory area. ">RingBuffer</a>.  <a href="#gab8bdf9f19d8d4ebacc793b22afd90768">More...</a><br/></td></tr>
<tr class="separator:gab8bdf9f19d8d4ebacc793b22afd90768"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga78ecc0240d02beed08b04f5c69dd3f2c"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga78ecc0240d02beed08b04f5c69dd3f2c">ringbuf_read</a> (<a class="el" href="structRingBuffer.html">RingBuffer</a> *buf, char *read_buffer, uint16_t n)</td></tr>
<tr class="memdesc:ga78ecc0240d02beed08b04f5c69dd3f2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read n bytes from a ring buffer.  <a href="#ga78ecc0240d02beed08b04f5c69dd3f2c">More...</a><br/></td></tr>
<tr class="separator:ga78ecc0240d02beed08b04f5c69dd3f2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadf69ccbc6389e013322d06a0516d9db5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gadf69ccbc6389e013322d06a0516d9db5">logger_enable</a> (void)</td></tr>
<tr class="memdesc:gadf69ccbc6389e013322d06a0516d9db5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable TA1 to begin logging by setting mode control to "up" mode, counter counts to TAxCCR0.  <a href="#gadf69ccbc6389e013322d06a0516d9db5">More...</a><br/></td></tr>
<tr class="separator:gadf69ccbc6389e013322d06a0516d9db5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeb449c011f90affd5c104e98298704b5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gaeb449c011f90affd5c104e98298704b5">logger_disable</a> (void)</td></tr>
<tr class="memdesc:gaeb449c011f90affd5c104e98298704b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disable TA1 to halt logging by setting mode control to STOP.  <a href="#gaeb449c011f90affd5c104e98298704b5">More...</a><br/></td></tr>
<tr class="separator:gaeb449c011f90affd5c104e98298704b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga190ea6537ba0138967b2f60ce4913c8d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga190ea6537ba0138967b2f60ce4913c8d">interrupt</a> (TIMER1_A0_VECTOR)</td></tr>
<tr class="memdesc:ga190ea6537ba0138967b2f60ce4913c8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt service routine for Timer A1 (TA1), where we should log one block of data.  <a href="#ga190ea6537ba0138967b2f60ce4913c8d">More...</a><br/></td></tr>
<tr class="separator:ga190ea6537ba0138967b2f60ce4913c8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaef39e368becfc8ede2d7e992660ded8"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gaaef39e368becfc8ede2d7e992660ded8">interrupt</a> (PORT1_VECTOR)</td></tr>
<tr class="memdesc:gaaef39e368becfc8ede2d7e992660ded8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt vector for button S1 which is used for enabled and disabling logging.  <a href="#gaaef39e368becfc8ede2d7e992660ded8">More...</a><br/></td></tr>
<tr class="separator:gaaef39e368becfc8ede2d7e992660ded8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga27007f0867b8c6ce1fb3b7943e2bc945"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga27007f0867b8c6ce1fb3b7943e2bc945"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga27007f0867b8c6ce1fb3b7943e2bc945">interrupt</a> (PORT2_VECTOR)</td></tr>
<tr class="memdesc:ga27007f0867b8c6ce1fb3b7943e2bc945"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt vector for button S2. <br/></td></tr>
<tr class="separator:ga27007f0867b8c6ce1fb3b7943e2bc945"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga1b0c2354b01b207919e638c5db342824"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga1b0c2354b01b207919e638c5db342824"></a>
static volatile uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>time</b></td></tr>
<tr class="separator:ga1b0c2354b01b207919e638c5db342824"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga10ab8a8cd50badbe26d5d0e04b263f92"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga10ab8a8cd50badbe26d5d0e04b263f92"></a>
static volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>logger_running</b></td></tr>
<tr class="separator:ga10ab8a8cd50badbe26d5d0e04b263f92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0eb1ac42313417f7c16e8fca853fd12f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0eb1ac42313417f7c16e8fca853fd12f"></a>
static volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>file_open</b></td></tr>
<tr class="separator:ga0eb1ac42313417f7c16e8fca853fd12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga264c2cc44242eb9a8430539752d1b432"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga264c2cc44242eb9a8430539752d1b432"></a>
static char&#160;</td><td class="memItemRight" valign="bottom"><b>s</b> [<a class="el" href="group__UART.html#gaeec38153163908e428304567b3623e03">UART_BUF_LEN</a>]</td></tr>
<tr class="separator:ga264c2cc44242eb9a8430539752d1b432"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0c58ec988b438001baccda2c77966547"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga0c58ec988b438001baccda2c77966547"></a>
static char&#160;</td><td class="memItemRight" valign="bottom"><b>ringbuf</b> [<a class="el" href="group__logger.html#gafacd61cc6eb6a06283bfc5a9824e0760">SD_RINGBUF_LEN</a>]</td></tr>
<tr class="separator:ga0c58ec988b438001baccda2c77966547"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8e106526932e3c95b903409ab35b0882"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga8e106526932e3c95b903409ab35b0882"></a>
static char&#160;</td><td class="memItemRight" valign="bottom"><b>writebuf</b> [512]</td></tr>
<tr class="separator:ga8e106526932e3c95b903409ab35b0882"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad897897d6e8cd86086d5ebaa9a21d0d4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad897897d6e8cd86086d5ebaa9a21d0d4"></a>
static <a class="el" href="structRingBuffer.html">RingBuffer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gad897897d6e8cd86086d5ebaa9a21d0d4">sdbuf</a></td></tr>
<tr class="memdesc:gad897897d6e8cd86086d5ebaa9a21d0d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">A <a class="el" href="structRingBuffer.html" title="A ring buffer which can be attached to given (preallocated) memory area. ">RingBuffer</a> that we will use to buffer sets of samples that are to be moved to the SD card. <br/></td></tr>
<tr class="separator:gad897897d6e8cd86086d5ebaa9a21d0d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga71df2a91147f5867de7713ac87c8f1aa"><td class="memItemLeft" align="right" valign="top">static volatile <a class="el" href="structSampleBuffer.html">SampleBuffer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga71df2a91147f5867de7713ac87c8f1aa">sb</a></td></tr>
<tr class="memdesc:ga71df2a91147f5867de7713ac87c8f1aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">A <a class="el" href="structSampleBuffer.html" title="A structure to contain one &#39;set&#39; of samples from the vehicle. ">SampleBuffer</a> to store a single set of readings before they are transferred into the SD transaction buffer.  <a href="#ga71df2a91147f5867de7713ac87c8f1aa">More...</a><br/></td></tr>
<tr class="separator:ga71df2a91147f5867de7713ac87c8f1aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8f47e042c2aca024c6534fdf5c3d9426"><td class="memItemLeft" align="right" valign="top">FATFS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga8f47e042c2aca024c6534fdf5c3d9426">FatFs</a></td></tr>
<tr class="memdesc:ga8f47e042c2aca024c6534fdf5c3d9426"><td class="mdescLeft">&#160;</td><td class="mdescRight">A FATFS filesystem object which we use to handle files and directories on the SD Card.  <a href="#ga8f47e042c2aca024c6534fdf5c3d9426">More...</a><br/></td></tr>
<tr class="separator:ga8f47e042c2aca024c6534fdf5c3d9426"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4be63952e3c9cb0f46f9e592b3c78714"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga4be63952e3c9cb0f46f9e592b3c78714"></a>
FIL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga4be63952e3c9cb0f46f9e592b3c78714">fil</a></td></tr>
<tr class="memdesc:ga4be63952e3c9cb0f46f9e592b3c78714"><td class="mdescLeft">&#160;</td><td class="mdescRight">A pointer to the data file. <br/></td></tr>
<tr class="separator:ga4be63952e3c9cb0f46f9e592b3c78714"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga94b465c64e7406994a32b0a3d6162264"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga94b465c64e7406994a32b0a3d6162264"></a>
DWORD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga94b465c64e7406994a32b0a3d6162264">fsz</a></td></tr>
<tr class="memdesc:ga94b465c64e7406994a32b0a3d6162264"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the current size of the data file. <br/></td></tr>
<tr class="separator:ga94b465c64e7406994a32b0a3d6162264"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaab96a16b4002b0b6c5a633f04116fb26"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaab96a16b4002b0b6c5a633f04116fb26"></a>
char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gaab96a16b4002b0b6c5a633f04116fb26">RingBuffer::buffer</a></td></tr>
<tr class="memdesc:gaab96a16b4002b0b6c5a633f04116fb26"><td class="mdescLeft">&#160;</td><td class="mdescRight">A pointer to the start of the character buffer to be used by this ring buffer. <br/></td></tr>
<tr class="separator:gaab96a16b4002b0b6c5a633f04116fb26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad94cc79525f7d91b1f94cc727fdf1b62"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad94cc79525f7d91b1f94cc727fdf1b62"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gad94cc79525f7d91b1f94cc727fdf1b62">RingBuffer::head</a></td></tr>
<tr class="memdesc:gad94cc79525f7d91b1f94cc727fdf1b62"><td class="mdescLeft">&#160;</td><td class="mdescRight">A pointer to the head of the ring buffer (the next free byte available for writing). <br/></td></tr>
<tr class="separator:gad94cc79525f7d91b1f94cc727fdf1b62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabc28ed906fd4e664a996837fbe379af6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gabc28ed906fd4e664a996837fbe379af6"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gabc28ed906fd4e664a996837fbe379af6">RingBuffer::tail</a></td></tr>
<tr class="memdesc:gabc28ed906fd4e664a996837fbe379af6"><td class="mdescLeft">&#160;</td><td class="mdescRight">A pointer to the tail of the ring buffer (the next unread byte) <br/></td></tr>
<tr class="separator:gabc28ed906fd4e664a996837fbe379af6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga850aaa0b65cb42a57574ff1aba2b785d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga850aaa0b65cb42a57574ff1aba2b785d"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga850aaa0b65cb42a57574ff1aba2b785d">RingBuffer::len</a></td></tr>
<tr class="memdesc:ga850aaa0b65cb42a57574ff1aba2b785d"><td class="mdescLeft">&#160;</td><td class="mdescRight">The length of the ring buffer. <br/></td></tr>
<tr class="separator:ga850aaa0b65cb42a57574ff1aba2b785d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga005412793d732ac49515837fbb182f3d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga005412793d732ac49515837fbb182f3d"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga005412793d732ac49515837fbb182f3d">RingBuffer::mask</a></td></tr>
<tr class="memdesc:ga005412793d732ac49515837fbb182f3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This value is a ring buffer intrinsic and is automatically generated. <br/></td></tr>
<tr class="separator:ga005412793d732ac49515837fbb182f3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga94b379854b10359da1ed98113634130e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga94b379854b10359da1ed98113634130e"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga94b379854b10359da1ed98113634130e">RingBuffer::overflow</a></td></tr>
<tr class="memdesc:ga94b379854b10359da1ed98113634130e"><td class="mdescLeft">&#160;</td><td class="mdescRight">A flag that will be set non-zero if a buffer overflow occurs (the head tries to "overtake" the tail. <br/></td></tr>
<tr class="separator:ga94b379854b10359da1ed98113634130e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad08c877a8bf235f2cdaf78782f8ac5fe"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gad08c877a8bf235f2cdaf78782f8ac5fe"></a>
volatile uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#gad08c877a8bf235f2cdaf78782f8ac5fe">SampleBuffer::adc</a> [<a class="el" href="group__logger.html#ga065dcfa648ca52ed6214008cb177de36">ADC_CHANNELS</a>]</td></tr>
<tr class="memdesc:gad08c877a8bf235f2cdaf78782f8ac5fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage for the ADC channels. <br/></td></tr>
<tr class="separator:gad08c877a8bf235f2cdaf78782f8ac5fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9000597ffb24f87fb295587c7a443d9c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga9000597ffb24f87fb295587c7a443d9c"></a>
volatile uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__logger.html#ga9000597ffb24f87fb295587c7a443d9c">SampleBuffer::accel</a> [<a class="el" href="group__logger.html#ga97ed3fe57790c99c8e351a42713c604d">ACCEL_CHANNELS</a>]</td></tr>
<tr class="memdesc:ga9000597ffb24f87fb295587c7a443d9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Storage for the accelerometer channels. <br/></td></tr>
<tr class="separator:ga9000597ffb24f87fb295587c7a443d9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga97ed3fe57790c99c8e351a42713c604d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ACCEL_CHANNELS&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The number of accelerometer channels (typically 3) to be sampled from. </p>
<p>This must be set correctly such that the DMA transfer system will work correctly. </p>

</div>
</div>
<a class="anchor" id="ga065dcfa648ca52ed6214008cb177de36"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ADC_CHANNELS&#160;&#160;&#160;7</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The number of ADC channels that we will sample from. </p>
<p>It is vital that this is correctly set such that the DMA system will work properly. </p>

</div>
</div>
<a class="anchor" id="ga35dd3a7fa4393edc7a82d7e00ea062f2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rb_getfree_m</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b</td><td>)</td>
          <td>&#160;&#160;&#160;((b-&gt;tail==b-&gt;head) ? b-&gt;len : (b-&gt;tail - b-&gt;head + b-&gt;len) % b-&gt;len)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Quick facility to get the free value of a ring buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b</td><td>A pointer to the buffer which we wish to query </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga7dd46e9f5adb1f95d06cecebcd77131c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rb_getused_m</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b</td><td>)</td>
          <td>&#160;&#160;&#160;((b-&gt;tail==b-&gt;head) ? 0:(b-&gt;head - b-&gt;tail + b-&gt;len) % b-&gt;len)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Quick facility to get the used value of a ring buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b</td><td>A pointer to the buffer which we wish to query </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ga44d4b9b7c0b6f5dd08e9416d092bdfb3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rb_reset_m</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b</td><td>)</td>
          <td>&#160;&#160;&#160;do {b-&gt;tail = b-&gt;head = 0} while (0)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset a ring buffer to its original empty state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b</td><td>A pointer to the buffer which we wish to query </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaa92c48a4b6b3ea015e31a01e940c440b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_RINGBUF_MASK&#160;&#160;&#160;(<a class="el" href="group__logger.html#gafacd61cc6eb6a06283bfc5a9824e0760">SD_RINGBUF_LEN</a> - 1)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The ring buffer mask value. </p>
<p>This is automatically calculated. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga190ea6537ba0138967b2f60ce4913c8d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">interrupt </td>
          <td>(</td>
          <td class="paramtype">TIMER1_A0_VECTOR&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt service routine for Timer A1 (TA1), where we should log one block of data. </p>
<p>We do this by copying the current <a class="el" href="structSampleBuffer.html" title="A structure to contain one &#39;set&#39; of samples from the vehicle. ">SampleBuffer</a> into the <a class="el" href="structRingBuffer.html" title="A ring buffer which can be attached to given (preallocated) memory area. ">RingBuffer</a> used for SD transactions. There is no processing of the data since it is too slow &ndash; this is left to post-processing on a desktop machine. We then trigger the next conversion runs for the ADC and accelerometer such that next time we enter this ISR, new data will be in the <a class="el" href="structSampleBuffer.html" title="A structure to contain one &#39;set&#39; of samples from the vehicle. ">SampleBuffer</a> sb. </p>

</div>
</div>
<a class="anchor" id="gaaef39e368becfc8ede2d7e992660ded8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">interrupt </td>
          <td>(</td>
          <td class="paramtype">PORT1_VECTOR&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt vector for button S1 which is used for enabled and disabling logging. </p>
<p>We should debounce the button press using the system ticks timer, and then enable or disable logging as required. </p>

</div>
</div>
<a class="anchor" id="gaeb449c011f90affd5c104e98298704b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void logger_disable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disable TA1 to halt logging by setting mode control to STOP. </p>
<p>The flag logger_running is deasserted so that the <a class="el" href="group__logger.html#ga8b1e9f609a5fb4ca026b9f3a9e0ebc41" title="Set up the SD card and the FATFS filesystem handler before commencing the logging service...">start_logger()</a> loop notices and cleanly flushes and closes the data file. We also write to the LCD to show that logging has stopped.</p>
<dl class="section note"><dt>Note</dt><dd>logger_running is deasserted after the timer is stopped. </dd></dl>

</div>
</div>
<a class="anchor" id="gadf69ccbc6389e013322d06a0516d9db5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void logger_enable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable TA1 to begin logging by setting mode control to "up" mode, counter counts to TAxCCR0. </p>
<p>The flag variable logger_running is asserted such that the <a class="el" href="group__logger.html#ga8b1e9f609a5fb4ca026b9f3a9e0ebc41" title="Set up the SD card and the FATFS filesystem handler before commencing the logging service...">start_logger()</a> loop notices that logging has started as should open the data file if it has not already done so. We also write to the LCD to show that logging has been started. </p>
<dl class="section note"><dt>Note</dt><dd>logger_running is asserted before the timer is enabled. </dd></dl>

</div>
</div>
<a class="anchor" id="ga7f0a1ef369c8017a21abc0f68371b64e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void logger_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up the hardware for logging functionality, including the configuration of required peripherals such as the ADC and Accelerometer. </p>
<p>Timer A1 (TA1) is configured to interrupt at the log frequency (1kHz), the interrupt service routine (ISR) is TIMER1_A0_ISR() also found in this file (please see that function's documentation for details of what is done in the ISR).</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Calculate TAxCCR0 value based on F_CPU instead of hard-coding. </dd></dl>

</div>
</div>
<a class="anchor" id="ga78ecc0240d02beed08b04f5c69dd3f2c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ringbuf_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRingBuffer.html">RingBuffer</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>read_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read n bytes from a ring buffer. </p>
<p>This is done via a fast memcpy operation and as such, there is logic in this function to transparently handle the copy even if we're wrapping over the boundary of the ring buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>A pointer to the ring buffer we want to write to </td></tr>
    <tr><td class="paramname">read_buffer</td><td>Copy data into this array </td></tr>
    <tr><td class="paramname">n</td><td>The number of bytes to be read from the ring buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 for success, non-0 for failure </dd></dl>

</div>
</div>
<a class="anchor" id="gab8bdf9f19d8d4ebacc793b22afd90768"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ringbuf_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRingBuffer.html">RingBuffer</a> *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write n bytes to a <a class="el" href="structRingBuffer.html" title="A ring buffer which can be attached to given (preallocated) memory area. ">RingBuffer</a>. </p>
<p>This is done via a fast memcpy operation and as such, there is logic in this function to transparently handle the copy even if we're wrapping over the boundary of the ring buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>A pointer to the ring buffer we want to write to </td></tr>
    <tr><td class="paramname">data</td><td>A pointer to the data to be written </td></tr>
    <tr><td class="paramname">n</td><td>The number of bytes to be written to the ring buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 for success, non-0 for failure </dd></dl>

</div>
</div>
<a class="anchor" id="gad722dfdb4da7ee009462dde1a83f4358"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FRESULT sd_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRingBuffer.html">RingBuffer</a> *&#160;</td>
          <td class="paramname"><em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>writebuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">FIL *&#160;</td>
          <td class="paramname"><em>fil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write n bytes from a ring buffer to an SD card controlled by fatfs. </p>
<p>We turn on the red LED on the board during an SD write transaction such that the user can monitor the frequency and duration of writes. This is particularly helpful in watching for SD clock stretching which often causes buffer overflow.</p>
<dl class="section note"><dt>Note</dt><dd>n should always be at least one sector (typically 512 bytes), hence the <a class="el" href="structRingBuffer.html" title="A ring buffer which can be attached to given (preallocated) memory area. ">RingBuffer</a> rb. Doing otherwise will work but will likely cause significant slowdown. The calling function can use the <a class="el" href="group__logger.html#ga7dd46e9f5adb1f95d06cecebcd77131c" title="Quick facility to get the used value of a ring buffer. ">rb_getused_m()</a> macro to determine when there is one sector's worth (or more) of data in the buffer and then call <a class="el" href="group__logger.html#gad722dfdb4da7ee009462dde1a83f4358" title="Write n bytes from a ring buffer to an SD card controlled by fatfs. ">sd_write()</a>.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rb</td><td>A pointer to the ring buffer from which we will read the required data. </td></tr>
    <tr><td class="paramname">writebuf</td><td>A short buffer where we can temporarily place a single before before writing it to the card. </td></tr>
    <tr><td class="paramname">n</td><td>The number of bytes to be written to the card. </td></tr>
    <tr><td class="paramname">fil</td><td>A pointer to the file to which we want to write. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>FRESULT The fatfs result code for the write operation. </dd></dl>

</div>
</div>
<a class="anchor" id="ga8b1e9f609a5fb4ca026b9f3a9e0ebc41"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start_logger </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRingBuffer.html">RingBuffer</a> *&#160;</td>
          <td class="paramname"><em>sdbuf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up the SD card and the FATFS filesystem handler before commencing the logging service. </p>
<p>The controls regularly moving blocks of data from the SD buffer to the card using <a class="el" href="group__logger.html#gad722dfdb4da7ee009462dde1a83f4358" title="Write n bytes from a ring buffer to an SD card controlled by fatfs. ">sd_write()</a>, which is done when the SD buffer size has reached at least the sector size such that we write as quickly as possible. It also calls for LCD display updates (with <a class="el" href="group__logger.html#gaf8a40257f5965ff6dd711c8b3923e4d1" title="Update the LCD with the current status of the logger, including buffer usage, data file size and SD c...">update_lcd()</a>) and handling opening/closing of the data file when logging starts/stops.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sdbuf</td><td>A pointer to the SD card buffer. This is a <a class="el" href="structRingBuffer.html" title="A ring buffer which can be attached to given (preallocated) memory area. ">RingBuffer</a> that we will use to buffer incoming samples before they are logged to the SD card, such that we can write entire sectors at once. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="gaf8a40257f5965ff6dd711c8b3923e4d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void update_lcd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structRingBuffer.html">RingBuffer</a> *&#160;</td>
          <td class="paramname"><em>buf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the LCD with the current status of the logger, including buffer usage, data file size and SD card utilisation. </p>
<dl class="section note"><dt>Note</dt><dd>This should not be called too regularly on the MSP-EXP430 board due to the SD card and LCD panel being on the same SPI bus and will cause slowdown of SD transactions.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>A pointer to the <a class="el" href="structRingBuffer.html" title="A ring buffer which can be attached to given (preallocated) memory area. ">RingBuffer</a> which we are monitoring. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ga8f47e042c2aca024c6534fdf5c3d9426"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">FATFS FatFs</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A FATFS filesystem object which we use to handle files and directories on the SD Card. </p>

</div>
</div>
<a class="anchor" id="ga71df2a91147f5867de7713ac87c8f1aa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile <a class="el" href="structSampleBuffer.html">SampleBuffer</a> sb</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A <a class="el" href="structSampleBuffer.html" title="A structure to contain one &#39;set&#39; of samples from the vehicle. ">SampleBuffer</a> to store a single set of readings before they are transferred into the SD transaction buffer. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 5 2014 10:07:05 for EV Logger by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
